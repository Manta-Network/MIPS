# MIP-0001 : MantaPay Protocol

```
Number:  MIP-0001
Title:   MantaPay Protocol
Type:    Standard
Status:  Draft
Authors: Shumo Chu (shumo@manta.network)
Created: 2021-06-18
```

## Abstract

`MIP-0001` describes the MantaPay protocol. This is inteneded to be an "informal" treatment
of the protocol that optimizes readablilty. The formal treatment of the protocol can be 
found in this [eprint](https://eprint.iacr.org/2021/743).

## Primitives

* *zkSNARK*: public-verifiable preprocessing zero-knowledge Succinct Non-interactive ARgument 
of Knowledge. zkSNARK is a proof system that verifies computation expressed in a circuit. 
Given a field F, a zkSANRK for F-arithmetic circuit satisfablility is defined by a triple of 
polynomial algorithms (`KeyGen`, `Prove`, `Verify`):
    1. `KeyGen`(1<sup>&lambda;</sup>, `C`) &rarr; (`pk`, `vk`). Taken a security parameter 
    &lambda; (e.g. 128 bits) and a F-arithmeic circuit `C`, `KeyGen` samples a pair of keys, 
    namely a proving key `pk` and a verification key `vk`. (`pk`, `vk`) is usually referred 
    as the public parameter or common reference string (CRS).
    2. `Prove`(`pk`, `x`, `a`) &rarr; &pi;. Taken a proving key `pk`, public input `x`, and 
    witness `a` as input, the proving function `Prove` (called by the prover) outputs a
    non-interactive zero-knowledge proof of the designated statement defined by `C`.
    3. `Verify`(`vk`, `x`, &pi;) &rarr; {0, 1}. Taken a verification key `vk`, and a 
    zero-knowledge proof &pi;, `Verify` (called by the verifier) outputs 1 if the prover is convinced that `C` is true, outputs 0 otherwise.
  A zkSNARK satisfies the following properties:
    - *Completeness*. An honest prover must convince the verifier with high probability 
      1 - `negl`(&lambda;).
    - *Soundness*. If the verifier accepts a proof from a prover with bounded computational
      power, then the prover must know the secrets input corresponding to the witness of the 
      given instance.
    - *Succinctness*. An honest-generated proof &pi; has constant size and the `Verify` runs 
      in time linear to `x`.
    - *Zero-Knowledge*. An honestly-generated proof is perfect zero knowledge 
      (the formal definition is based on the notion of the simulator, please refer to 
      A.1 section of the eprint).
* *Commitment* (`COMM`). A non-interactive commitment scheme `COMM` that is both hiding and
  binding (either computational or information theoretical). For example, given a random 
  seed `r`and a message `m`, the commitment is `c` := `COMM`<sub>r</sub>(`m`). `c` can be 
  opened by revealing `r` and `m`, which verifies the commitment.
* *Pseudo-Random Function* (`PRF`). More specifically, we use three labeled pseudo-random
  functions that instantiated from the same core function. For a seed `x`, we derive 
  `PRF`<sub>`x`</sub><sup>`addr`</sup>(&middot;), 
  `PRF`<sub>`x`</sub><sup>`vn`</sup>(&middot;), and
  `PRF`<sub>`x`</sub><sup>`pk`</sup>(&middot;), which is used to generate addresses, 
  void numbers, and public keys, accordingly. Currently, manta uses `Blake2s` as the core 
  function.
* *Cryptographic Accumulators* (`acc`). `acc` supports efficient, zero-knowledge, 
  membership proofs. Currently, Manta uses merkle tree with pedersen hashes as the `CRH` 
  (collision resistence hash). In MantaPay, we use a sharded accumulator with `256` shard,
  each shard can be indexed by a number from `0` to `255`, e.g. `acc`<sub>i</sub>, 
  where 0 &le; i &le; 255.
* *Elliptic Curve Integrated Encryption Scheme* (`ECIES`). `ECIES` is build on top of 
  (elliptic curve) Diffie-Hellman key exchange protocol, a key derivation function and a 
  block cipher. `ECIES` is used to encrypt the nomination of the UTXO using the receiver's 
  public key. (TODO (ask zz): add the instantiation of `ECIES` that Manta uses).

## Shielded Address, UTXO and Ledger State

* *Shielded Address*. A shielded address is the address that the receiver need to send to the 
  sender prior the transaction. A deserialized shielded address contains the following
  (see `MantaAssetShieldedAddress` in `manta-types/manta-asset`):
    - `asset_id`: an `u64` (TODO: to be revised) asset id
    - `k`: public information `k` (will be explained later) 
    - `s`: public information `s` (will be explained later)
    - `r`: public information `r` (will be expalined later)
    - `ecpk`: an ECIES public key of the receiver 
  The shielded address will be serialized into a `XXX` bytes address that can be encoded into 
  `XXX` base64 string. (TODO: specify a concrete protocol of serialization).
* *UTXO*. MantaPay uses UTXOs rather than account for the private coins. Both *Mint* and  
  *PrivateTranfer* generates a new UTXO to the ledger state. 
* *Ledger State*. MantaPay's ledger state contains the following:
    - `acc`: A sharded accumulator with `256` shard, i.e. `acc`<sub>i</sub>,  
      where 0 &le; i &le; 255. See `CoinShards` in `pallet-manta-pay`.
    - `vn_list`: a list of void numbers. A void number is also known as a `serial number` 
      or `nullifier` in other protocols. Each coin has a unique void number, and if this
      number is revealed, the coin is voided. See `VNList` in `pallet-manta-pay`.
    - `env_value_list`: a list of encrypted values (of the UTXOs). See `EncValueList` in 
      `pallet-manta-pay`.
    - `pool_balance`: the total balance of MantaPay's private asset pool. See `PoolBalance`
      in `pallet-manta-pay`.
    - `hash_param_checksum` (immutable): the checksum of the `CRH`'s parameters (used in    
      `acc`). See `HashParamChecksum` in `pallet-manta-pay`.
    - `commit_param_checksum` (immutable): the checksum of the commitment's parameters. See
      `CommitParamChecksum` in `pallet-manta-pay`.
    - `transfer_zkp_key_checksum` (immutable): the checksum of the verification key for 
       zero-knowledge proof for transfer protocol (`transfer_vk`). At the moment we are storing the whole serialized key in the ledger state. See `TransferZKPKeyChecksum` 
       in `pallet-manta-pay`.
    - `reclaim_zkp_key_checksum` (immutable): the checksum of the verification key for
       zero-knowledge proof for reclaim protocol (`reclaim_vk`). At the moment we are storing 
       the whole serialized key in the ledger state. See `ReclaimZKPKeyChecksum` in 
       `pallet-manta-pay`.

## MantaPay Protocol 

## Potential Issues
1. The index of the shard is determined by the first byte of the cm. 
   this may be potentially risky, since the commitment is a group element, 
   and the first byte may not be uniformly distributed between 0 and 255.
